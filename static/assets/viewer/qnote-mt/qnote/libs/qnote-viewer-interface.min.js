! function (i) {
    if ("undefined" != typeof window) {
        var j = !0,
            k = 10,
            l = "",
            m = 0,
            n = "",
            o = null,
            p = "",
            q = !1,
            r = {
                resize: 1,
                click: 1
            },
            s = 128,
            t = !0,
            u = 1,
            b = "bodyOffset",
            v = b,
            w = !0,
            x = "",
            y = {},
            z = 32,
            A = null,
            B = !1,
            C = !1,
            c = "[qnoteViewer]",
            D = c.length,
            E = "",
            F = {
                max: 1,
                min: 1,
                bodyScroll: 1,
                documentElementScroll: 1
            },
            G = "child",
            H = !0,
            I = window.parent,
            J = "*",
            K = 0,
            L = !1,
            M = null,
            N = 16,
            O = 1,
            d = "scroll",
            P = d,
            Q = window,
            R = function () {
                ah("onMessage function not defined")
            },
            S = function () {},
            T = function () {},
            U = {
                height: function () {
                    return ah("Custom height calculation function not defined"), document.documentElement.offsetHeight
                },
                width: function () {
                    return ah("Custom width calculation function not defined"), document.body.scrollWidth
                }
            },
            V = {},
            W = !1;
        try {
            var a = Object.create({}, {
                passive: {
                    get: function () {
                        W = !0
                    }
                }
            });
            window.addEventListener("test", ac, a), window.removeEventListener("test", ac, a)
        } catch (X) {}
        var e, Y, Z, $, f, g, h, _ = {
                bodyOffset: function () {
                    return document.body.offsetHeight + aA("marginTop") + aA("marginBottom")
                },
                offset: function () {
                    return _.bodyOffset()
                },
                bodyScroll: function () {
                    return document.body.scrollHeight
                },
                custom: function () {
                    return U.height()
                },
                documentElementOffset: function () {
                    return document.documentElement.offsetHeight
                },
                documentElementScroll: function () {
                    return document.documentElement.scrollHeight
                },
                max: function () {
                    return Math.max.apply(null, aC(_))
                },
                min: function () {
                    return Math.min.apply(null, aC(_))
                },
                grow: function () {
                    return _.max()
                },
                lowestElement: function () {
                    return Math.max(_.bodyOffset() || _.documentElementOffset(), aB("bottom", aE()))
                },
                taggedElement: function () {
                    return aD("bottom", "data-iframe-height")
                }
            },
            aa = {
                bodyScroll: function () {
                    return document.body.scrollWidth
                },
                bodyOffset: function () {
                    return document.body.offsetWidth
                },
                custom: function () {
                    return U.width()
                },
                documentElementScroll: function () {
                    return document.documentElement.scrollWidth
                },
                documentElementOffset: function () {
                    return document.documentElement.offsetWidth
                },
                scroll: function () {
                    return Math.max(aa.bodyScroll(), aa.documentElementScroll())
                },
                max: function () {
                    return Math.max.apply(null, aC(aa))
                },
                min: function () {
                    return Math.min.apply(null, aC(aa))
                },
                rightMostElement: function () {
                    return aB("right", aE())
                },
                taggedElement: function () {
                    return aD("right", "data-iframe-width")
                }
            },
            ab = (e = aF, f = null, g = 0, h = function () {
                g = Date.now(), f = null, $ = e.apply(Y, Z), f || (Y = Z = null)
            }, function () {
                var a = Date.now();
                g || (g = a);
                var b = N - (a - g);
                return Y = this, Z = arguments, b <= 0 || b > N ? (f && (clearTimeout(f), f = null), g = a, $ = e.apply(Y, Z), f || (Y = Z = null)) : f || (f = setTimeout(h, b)), $
            });
        ad(window, "message", function (a) {
            var b = {
                init: function () {
                    x = a.data, I = a.source, ai(), ag("Initialising iFrame (" + window.location.href + ")"), ak(), am(), al("background", l), al("padding", p), au(), ar(), as(), an(), ax(), aw(), at(), y = av(), aG("init", "Init message from host page"), S(), t = !1, setTimeout(function () {
                        w = !1
                    }, s)
                },
                reset: function () {
                    w ? ag("Page reset ignored by init") : (ag("Page size reset by host page"), aI("resetPage"))
                },
                resize: function () {
                    aG("resizeParent", "Parent window requested size check")
                },
                moveToAnchor: function () {
                    y.findTarget(e())
                },
                inPageLink: function () {
                    this.moveToAnchor()
                },
                pageInfo: function () {
                    var a = e();
                    ag("PageInfoFromParent called from parent: " + a), T(JSON.parse(a)), ag(" --")
                },
                message: function () {
                    var a = e();
                    ag("onMessage called from parent: " + a), R(JSON.parse(a)), ag(" --")
                }
            };

            function d() {
                return a.data.split("]")[1].split(":")[0]
            }

            function e() {
                return a.data.slice(a.data.indexOf(":") + 1)
            }

            function f() {
                return a.data.split(":")[2] in {
                    true: 1,
                    false: 1
                }
            }
            c === ("" + a.data).slice(0, D) && function () {
                if (!1 === t) {
                    var c;
                    (c = d()) in b ? b[c]() : !("undefined" != typeof module && module.exports) && "iFrameResize" in window || "jQuery" in window && "iFrameResize" in window.jQuery.prototype || f() || ah("Unexpected message (" + a.data + ")")
                } else f() ? b.init() : ag('Ignored message of type "' + d() + '". Received before initialization.')
            }()
        }), ad(window, "readystatechange", aL), aL()
    }

    function ac() {}

    function ad(a, b, c, d) {
        a.addEventListener(b, c, !!W && (d || {}))
    }

    function ae(a) {
        return a.charAt(0).toUpperCase() + a.slice(1)
    }

    function af(a) {
        return c + "[" + E + "] " + a
    }

    function ag(a) {
        B && "object" == typeof window.console && console.log(af(a))
        // window.console.log(af(a));
    }

    function ah(a) {
        "object" == typeof window.console && console.warn(af(a))
    }

    function ai() {
        function b(a) {
            return "true" === a
        }
        var a = x.slice(D).split(":");
        E = a[0], m = i !== a[1] ? Number(a[1]) : m, q = i !== a[2] ? b(a[2]) : q, B = i !== a[3] ? b(a[3]) : B, z = i !== a[4] ? Number(a[4]) : z, j = i !== a[6] ? b(a[6]) : j, n = a[7], v = i !== a[8] ? a[8] : v, l = a[9], p = a[10], K = i !== a[11] ? Number(a[11]) : K, y.enable = i !== a[12] && b(a[12]), G = i !== a[13] ? a[13] : G, P = i !== a[14] ? a[14] : P, C = i !== a[15] ? Boolean(a[15]) : C
    }

    function aj(a) {
        var b = a.split("Callback");
        if (2 === b.length) {
            var c = "on" + b[0].charAt(0).toUpperCase() + b[0].slice(1);
            this[c] = this[a], delete this[a], ah("Deprecated: '" + a + "' has been renamed '" + c + "'. The old method will be removed in the next major version.")
        }
    }

    function ak() {
        function b(a, b) {
            return "function" == typeof a && (ag("Setup custom " + b + "CalcMethod"), U[b] = a, a = "custom"), a
        }
        if ("qnoteViewer" in window && Object === window.qnoteViewer.constructor) {
            var a;
            a = window.qnoteViewer, ag("Reading data from page: " + JSON.stringify(a)), Object.keys(a).forEach(aj, a), R = "onMessage" in a ? a.onMessage : R, S = "onReady" in a ? a.onReady : S, J = "targetOrigin" in a ? a.targetOrigin : J, v = "heightCalculationMethod" in a ? a.heightCalculationMethod : v, P = "widthCalculationMethod" in a ? a.widthCalculationMethod : P, v = b(v, "height"), P = b(P, "width")
        }
        ag("TargetOrigin for parent set to: " + J)
    }

    function al(b, a) {
        i !== a && "" !== a && "null" !== a && (document.body.style[b] = a, ag("Body " + b + ' set to "' + a + '"'))
    }

    function am() {
        var b, a;
        i === n && (n = m + "px"), al("margin", (b = "margin", -1 !== (a = n).indexOf("-") && (ah("Negative CSS value ignored for " + b), a = ""), a))
    }

    function an() {
        document.documentElement.style.height = "", document.body.style.height = "", ag('HTML & body height set to "auto"')
    }

    function ao(a) {
        var b = {
            add: function (b) {
                function c() {
                    aG(a.eventName, a.eventType)
                }
                V[b] = c, ad(window, b, c, {
                    passive: !0
                })
            },
            remove: function (a) {
                var b = V[a];
                delete V[a],
                    function (a, b, c) {
                        a.removeEventListener(b, c, !1)
                    }(window, a, b)
            }
        };
        a.eventNames && Array.prototype.map ? (a.eventName = a.eventNames[0], a.eventNames.map(b[a.method])) : b[a.method](a.eventName), ag(ae(a.method) + " event listener: " + a.eventType)
    }

    function ap(a) {
        ao({
            method: a,
            eventType: "Animation Start",
            eventNames: ["animationstart", "webkitAnimationStart"]
        }), ao({
            method: a,
            eventType: "Animation Iteration",
            eventNames: ["animationiteration", "webkitAnimationIteration"]
        }), ao({
            method: a,
            eventType: "Animation End",
            eventNames: ["animationend", "webkitAnimationEnd"]
        }), ao({
            method: a,
            eventType: "Input",
            eventName: "input"
        }), ao({
            method: a,
            eventType: "Mouse Up",
            eventName: "mouseup"
        }), ao({
            method: a,
            eventType: "Mouse Down",
            eventName: "mousedown"
        }), ao({
            method: a,
            eventType: "Orientation Change",
            eventName: "orientationchange"
        }), ao({
            method: a,
            eventType: "Print",
            eventNames: ["afterprint", "beforeprint"]
        }), ao({
            method: a,
            eventType: "Ready State Change",
            eventName: "readystatechange"
        }), ao({
            method: a,
            eventType: "Touch Start",
            eventName: "touchstart"
        }), ao({
            method: a,
            eventType: "Touch End",
            eventName: "touchend"
        }), ao({
            method: a,
            eventType: "Touch Cancel",
            eventName: "touchcancel"
        }), ao({
            method: a,
            eventType: "Transition Start",
            eventNames: ["transitionstart", "webkitTransitionStart", "MSTransitionStart", "oTransitionStart", "otransitionstart"]
        }), ao({
            method: a,
            eventType: "Transition Iteration",
            eventNames: ["transitioniteration", "webkitTransitionIteration", "MSTransitionIteration", "oTransitionIteration", "otransitioniteration"]
        }), ao({
            method: a,
            eventType: "Transition End",
            eventNames: ["transitionend", "webkitTransitionEnd", "MSTransitionEnd", "oTransitionEnd", "otransitionend"]
        }), "child" === G && ao({
            method: a,
            eventType: "IFrame Resized",
            eventName: "resize"
        })
    }

    function aq(a, b, d, c) {
        return b !== a && (a in d || (ah(a + " is not a valid option for " + c + "CalculationMethod."), a = b), ag(c + ' calculation method set to "' + a + '"')), a
    }

    function ar() {
        v = aq(v, b, _, "height")
    }

    function as() {
        P = aq(P, d, aa, "width")
    }

    function at() {
        !0 === j ? (ap("add"), az()) : ag("Auto Resize disabled")
    }

    function au() {
        var a = document.createElement("div");
        a.style.clear = "both", a.style.display = "block", a.style.height = "0", document.body.appendChild(a)
    }

    function av() {
        function b(e) {
            var h, j, c, d, a, b = e.split("#")[1] || e,
                f = decodeURIComponent(b),
                g = document.getElementById(f) || document.getElementsByName(f)[0];
            i !== g ? (a = (c = g.getBoundingClientRect(), d = {
                x: i !== window.pageXOffset ? window.pageXOffset : document.documentElement.scrollLeft,
                y: i !== window.pageYOffset ? window.pageYOffset : document.documentElement.scrollTop
            }, {
                x: parseInt(c.left, 10) + parseInt(d.x, 10),
                y: parseInt(c.top, 10) + parseInt(d.y, 10)
            }), ag("Moving to in page link (#" + b + ") at x: " + a.x + " y: " + a.y), aK(a.y, a.x, "scrollToOffset")) : (ag("In page link (#" + b + ") not found in iFrame, so sending to parent"), aK(0, 0, "inPageLink", "#" + b))
        }

        function a() {
            var a = window.location.hash,
                c = window.location.href;
            "" !== a && "#" !== a && b(c)
        }
        return y.enable ? Array.prototype.forEach && document.querySelectorAll ? (ag("Setting up location.hash handlers"), Array.prototype.forEach.call(document.querySelectorAll('a[href^="#"]'), function (a) {
            "#" !== a.getAttribute("href") && ad(a, "click", function (a) {
                a.preventDefault(), b(this.getAttribute("href"))
            })
        }), ad(window, "hashchange", a), setTimeout(a, s)) : ah("In page linking not fully supported in this browser! (See README.md for IE8 workaround)") : ag("In page linking not enabled"), {
            findTarget: b
        }
    }

    function aw() {
        function b(a) {
            aK(0, 0, a.type, a.screenY + ":" + a.screenX)
        }

        function a(a, c) {
            ag("Add event listener: " + c), ad(window.document, a, b)
        }!0 === C && (a("mouseenter", "Mouse Enter"), a("mouseleave", "Mouse Leave"))
    }

    function ax() {
        ag("Enable public methods"), Q.parentQnote = {
            autoResize: function (a) {
                return !0 === a && !1 === j ? (j = !0, at()) : !1 === a && !0 === j && (j = !1, ap("remove"), null !== o && o.disconnect(), clearInterval(A)), aK(0, 0, "autoResize", JSON.stringify(j)), j
            },
            close: function () {
                aK(0, 0, "close")
            },
            getId: function () {
                return E
            },
            getPageInfo: function (a) {
                "function" == typeof a ? (T = a, aK(0, 0, "pageInfo")) : (T = function () {}, aK(0, 0, "pageInfoStop"))
            },
            moveToAnchor: function (a) {
                y.findTarget(a)
            },
            reset: function () {
                aJ("parentQnote.reset")
            },
            scrollTo: function (a, b) {
                aK(b, a, "scrollTo")
            },
            scrollToOffset: function (a, b) {
                aK(b, a, "scrollToOffset")
            },
            sendMessage: function (a, b) {
                aK(0, 0, "message", JSON.stringify(a), b)
            },
            setHeightCalculationMethod: function (a) {
                v = a, ar()
            },
            setWidthCalculationMethod: function (a) {
                P = a, as()
            },
            setTargetOrigin: function (a) {
                ag("Set targetOrigin: " + a), J = a
            },
            size: function (b, a) {
                aG("size", "parentQnote.size(" + ("" + (b || "") + (a ? "," + a : "")) + ")", b, a)
            }
        }
    }

    function ay() {
        0 !== z && (ag("setInterval: " + z + "ms"), A = setInterval(function () {
            aG("interval", "setInterval: " + z)
        }, Math.abs(z)))
    }

    function az() {
        window.MutationObserver || window.WebKitMutationObserver ? 0 > z ? ay() : o = function () {
            function d(a) {
                function b(a) {
                    !1 === a.complete && (ag("Attach listeners to " + a.src), a.addEventListener("load", g, !1), a.addEventListener("error", h, !1), i.push(a))
                }
                "attributes" === a.type && "src" === a.attributeName ? b(a.target) : "childList" === a.type && Array.prototype.forEach.call(a.target.querySelectorAll("img"), b)
            }

            function e(a) {
                var b;
                ag("Remove listeners from " + a.src), a.removeEventListener("load", g, !1), a.removeEventListener("error", h, !1), b = a, i.splice(i.indexOf(b), 1)
            }

            function f(a, b, c) {
                e(a.target), aG(b, c + ": " + a.target.src)
            }

            function g(a) {
                f(a, "imageLoad", "Image loaded")
            }

            function h(a) {
                f(a, "imageLoadFailed", "Image load failed")
            }
            var b, i = [],
                c = window.MutationObserver || window.WebKitMutationObserver,
                a = (b = document.querySelector("body"), a = new c(function (a) {
                    aG("mutationObserver", "mutationObserver: " + a[0].target + " " + a[0].type), a.forEach(d)
                }), ag("Create body MutationObserver"), a.observe(b, {
                    attributes: !0,
                    attributeOldValue: !1,
                    characterData: !0,
                    characterDataOldValue: !1,
                    childList: !0,
                    subtree: !0
                }), a);
            return {
                disconnect: function () {
                    "disconnect" in a && (ag("Disconnect body MutationObserver"), a.disconnect(), i.forEach(e))
                }
            }
        }() : (ag("MutationObserver not supported in this browser!"), ay())
    }

    function aA(c, b) {
        var a = 0;
        return b = b || document.body, a = document.defaultView.getComputedStyle(b, null), a = null !== a ? a[c] : 0, parseInt(a, k)
    }

    function aB(e, c) {
        for (var f, g = c.length, h = 0, d = 0, i = ae(e), a = Date.now(), b = 0; b < g; b++)(h = c[b].getBoundingClientRect()[e] + aA("margin" + i, c[b])) > d && (d = h);
        return a = Date.now() - a, ag("Parsed " + g + " HTML elements"), ag("Element position calculated in " + a + "ms"), (f = a) > N / 2 && ag("Event throttle increased to " + (N = 2 * f) + "ms"), d
    }

    function aC(a) {
        return [a.bodyOffset(), a.bodyScroll(), a.documentElementOffset(), a.documentElementScroll()]
    }

    function aD(c, a) {
        var b = document.querySelectorAll("[" + a + "]");
        return 0 === b.length && (ah("No tagged elements (" + a + ") found on page"), document.querySelectorAll("body *")), aB(c, b)
    }

    function aE() {
        return document.querySelectorAll("body *")
    }

    function aF(a, b, e, f) {
        var c, d;
        (function () {
            function a(a, b) {
                return !(Math.abs(a - b) <= K)
            }
            return c = i !== e ? e : _[v](), d = i !== f ? f : aa[P](), a(u, c) || q && a(O, d)
        })() || "init" === a ? (aH(), aK(u = c, O = d, a)) : !(a in {
            init: 1,
            interval: 1,
            size: 1
        }) && (v in F || q && P in F) ? aJ(b) : a in {
            interval: 1
        } || ag("No change in size detected")
    }

    function aG(a, b, c, d) {
        L && a in r ? ag("Trigger event cancelled: " + a) : (a in {
            reset: 1,
            resetPage: 1,
            init: 1
        } || ag("Trigger event: " + b), "init" === a ? aF(a, b, c, d) : ab(a, b, c, d))
    }

    function aH() {
        L || (L = !0, ag("Trigger event lock on")), clearTimeout(M), M = setTimeout(function () {
            L = !1, ag("Trigger event lock off"), ag("--")
        }, s)
    }

    function aI(a) {
        aK(u = _[v](), O = aa[P](), a)
    }

    function aJ(a) {
        var c = v;
        v = b, ag("Reset trigger event: " + a), aH(), aI("reset"), v = c
    }

    function aK(e, f, g, b, a) {
        if (!0 === H) {
            var d;
            i === a ? a = J : ag("Message targetOrigin: " + a), ag("Sending message to host page (" + (d = E + ":" + (e + ":" + f) + ":" + g + (i !== b ? ":" + b : "")) + ")"), I.postMessage(c + d, a)
        }
    }

    function aL() {
        "loading" !== document.readyState && window.parent.postMessage("[qnoteViewerChild]Ready", "*")
    }
}()