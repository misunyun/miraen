<?xml version="1.0" encoding="UTF-8" standalone="no"?><addon xmlns="http://icplayer.com" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="EdgeAnimation" xsi:schemaLocation="http://icplayer.com ../../tools/addon.xsd">
	<model>
		<property name="Animations" nameLabel="EdgeAnimation_property_animations" type="list">
			<property displayName="Composition Class" name="compositionClass" nameLabel="EdgeAnimation_property_composition_class" type="string"/>
			<property displayName="edge.js" name="edgeFile" nameLabel="EdgeAnimation_property_edge_file" type="file"/>
			<property displayName="edgeActions.js" name="edgeActionsFile" nameLabel="EdgeAnimation_property_edge_actions_file" type="file"/>
		</property>
		<property name="Images" nameLabel="EdgeAnimation_property_images" type="list">
			<property displayName="Animation Item Number" name="animationItem" nameLabel="EdgeAnimation_property_animation_item" type="string"/>
			<property displayName="Edge element IDs (csv)" name="elementId" nameLabel="EdgeAnimation_property_element_id" type="string"/>
			<property displayName="Image File" name="imageFile" nameLabel="EdgeAnimation_property_image_file" type="image"/>
		</property>
		<property displayName="Initial Animation" name="initialAnimation" nameLabel="EdgeAnimation_property_initial_animation" type="string"/>
		<property name="Narration" nameLabel="EdgeAnimation_property_narration" type="narration"/>
	</model>
<css>.edgeMultiAnimWrapper{&#13;
    width: 100%;&#13;
    height: 100%;&#13;
}&#13;
&#13;
.Stage{&#13;
    position: absolute;&#13;
}&#13;
&#13;
.edge-loading-image{&#13;
    position: absolute;&#13;
    width: 30px;&#13;
    height: 30px;&#13;
    border: 0;&#13;
}&#13;
</css><view>&lt;div class="edgeMultiAnimWrapper"&gt;&#13;
&lt;/div&gt;&#13;
&lt;img src="" alt="Loading..." class="edge-loading-image"/&gt;&#13;
</view><preview>&lt;div class="edgeMultiAnimWrapper"&gt;&#13;
&lt;/div&gt;&#13;
</preview><presenter>function AddonEdgeAnimation_create(){&#13;
    var currentAnimationItem = 1;&#13;
&#13;
    var presenter = function(){};&#13;
    var onDocLoaded = null;&#13;
    var Animations;&#13;
    &#13;
    presenter.setStateStatus = false;&#13;
    presenter.commentAlreadyLoaded = false;&#13;
    presenter.$view = null;&#13;
&#13;
    presenter.run = function(view, model){&#13;
        Animations = model.Animations;&#13;
        presenter.Animations = model.Animations;&#13;
        presenter.addonID = model.ID;&#13;
        presenter.$view = $(view);&#13;
        presenter.model = model;&#13;
        presenter.autoplayState = undefined;&#13;
        &#13;
		presenter.isVisible = model["Is Visible"] == 'True';&#13;
		presenter.setVisibility(presenter.isVisible);&#13;
		&#13;
		//show loading icon&#13;
		var loadingSrc = DOMOperationsUtils.getResourceFullPath(presenter.playerController, "media/loading.gif");&#13;
		var loadingIconImg = $(view).find('.edge-loading-image')[0];&#13;
		$(loadingIconImg).css({&#13;
            left: (presenter.model.Width/2)-15 + 'px',&#13;
            top: (presenter.model.Height/2)-15 + 'px'&#13;
        });&#13;
		$(loadingIconImg).attr('src',loadingSrc);&#13;
		&#13;
		$(model.Animations).each(function(i, animation){&#13;
			if(animation.compositionClass === '' &amp;&amp; animation.edgeFile === '' &amp;&amp; animation.edgeActionsFile === ''){&#13;
				presenter.errorHandler("This addon needs all files in Animations list to work");&#13;
				return;&#13;
			}&#13;
		});&#13;
		&#13;
        presenter.preloadImages(model.Images, function() {&#13;
            presenter.presenterLogic(view, model);&#13;
        });&#13;
    };&#13;
&#13;
    presenter.createPreview = function (view, model) {&#13;
		//presenter.run(view,model);&#13;
    };&#13;
	&#13;
	presenter.setPlayerController = function (controller) {&#13;
        presenter.playerController = controller;&#13;
    };&#13;
	&#13;
	presenter.errorHandler = function(message){&#13;
		presenter.$view.prepend('&lt;div style="color: red; font-size: 12px; font-family: Arial;"&gt;'+message+'&lt;/span&gt;');&#13;
	};&#13;
	&#13;
    presenter.preloadImages = function(images, callback){&#13;
        var count = images.length;&#13;
        if(count === 1 &amp;&amp; images[0].imageFile === '') {&#13;
            callback();&#13;
        }&#13;
        var loaded = 0;&#13;
        $(images).each(function() {&#13;
            $('&lt;img&gt;').attr('src', this.imageFile).load(function() {&#13;
                loaded++;&#13;
                if (loaded === count) {&#13;
                    callback();&#13;
                }&#13;
            });&#13;
        });&#13;
    };&#13;
&#13;
    presenter.loadMediaToAnimation = function(model){&#13;
        var CompositionClass;&#13;
        var elementTagName;&#13;
		//IMAGES&#13;
		if(model.Images.length === 1 &amp;&amp; model.Images[0].imageFile === '') {&#13;
            return;&#13;
        }&#13;
        $(model.Images).each(function(index1, value){&#13;
            var animItemsArray = value.animationItem.split(',');&#13;
            var idsArray = value.elementId.split(',');&#13;
&#13;
            $(animItemsArray).each(function(index2, item){&#13;
&#13;
                $(idsArray).each(function(index3, id){&#13;
                    CompositionClass = model.Animations[item - 1].compositionClass;&#13;
&#13;
                    elementTagName = $("#Stage" + model.ID + CompositionClass + "_" + id).prop("tagName");&#13;
                    if(elementTagName == 'DIV'){&#13;
                        $("#Stage" + model.ID + CompositionClass + "_" + id).css("background-image", "url(" + value.imageFile + ")");&#13;
                    } else if(elementTagName=='IMG') {&#13;
                        $("#Stage" + model.ID + CompositionClass + "_" + id).attr('src', value.imageFile);&#13;
                    }&#13;
                });&#13;
&#13;
            });&#13;
        });&#13;
    };&#13;
&#13;
    presenter.presenterLogic = function(view, model){&#13;
        if(model.initialAnimation === ""){&#13;
            model.initialAnimation = 0;&#13;
        } else {&#13;
            model.initialAnimation = parseInt(model.initialAnimation, 10) - 1;&#13;
        }&#13;
&#13;
        $(model.Animations).each(function(i, animation){&#13;
            var display = "none";&#13;
            if(currentAnimationItem - 1 == i){&#13;
                display = "block";&#13;
            }&#13;
&#13;
            $('head').append('&lt;script&gt;    window.AdobeEdge = window.AdobeEdge || {};    window.AdobeEdge.bootstrapLoading = true; &lt;/script&gt;');&#13;
            $('head').append('&lt;!--Adobe Edge Runtime--&gt;');&#13;
            var headPrependStyle = '&lt;style&gt;.edgeLoad-' + animation.compositionClass + ' { visibility:hidden; }&lt;/style&gt;';&#13;
            $('head').append(headPrependStyle);&#13;
            $('head').append('&lt;!--Adobe Edge Runtime End--&gt;');&#13;
&#13;
            var stage = $('&lt;div&gt;&lt;/div&gt;');&#13;
            var edgeAnimWrapper = $(view).find('.edgeMultiAnimWrapper')[0];&#13;
&#13;
            stage.attr('id', 'Stage' + model.ID + animation.compositionClass);&#13;
            stage.addClass(animation.compositionClass);&#13;
            stage.css('display', display);&#13;
            stage.addClass('Stage');&#13;
            $(edgeAnimWrapper).prepend(stage);&#13;
				&#13;
            run(animation);&#13;
        });&#13;
&#13;
    };&#13;
&#13;
    function run(animation){&#13;
        (function(compId){&#13;
            window.AdobeEdge = window.AdobeEdge || {};&#13;
            window.AdobeEdge.bootstrapLoading = true;&#13;
            // Include yepnope&#13;
            if(!AdobeEdge.yepnope) {&#13;
                /*yepnope1.5.x|WTFPL*/&#13;
                (function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&amp;&amp;g(l.readyState)&amp;&amp;(u.r=o=1,!q&amp;&amp;h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&amp;&amp;m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&amp;&amp;y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&amp;&amp;(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&amp;&amp;(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&amp;&amp;h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&amp;&amp;!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&amp;&amp;"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&amp;&amp;!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&amp;&amp;(a.timeout=b[0]),a}},A,B;B=function(a){function b(a){var a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a},e,f,g;for(f=0;f&lt;d;f++)g=a[f].split("="),(e=z[g.shift()])&amp;&amp;(c=e(c,g));for(f=0;f&lt;b;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&amp;&amp;(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&amp;&amp;"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&amp;&amp;f.load(function(){k(),e&amp;&amp;e(i.origUrl,h,g),j&amp;&amp;j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var b=0,c;for(c in a)a.hasOwnProperty(c)&amp;&amp;b++;return b}(),a)a.hasOwnProperty(n)&amp;&amp;(!c&amp;&amp;!--m&amp;&amp;(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&amp;&amp;a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&amp;&amp;l()}var h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f,m,n;c(h?a.yep:a.nope,!!i),i&amp;&amp;c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i&lt;a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&amp;&amp;h(j,l);else Object(a)===a&amp;&amp;h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&amp;&amp;b.addEventListener&amp;&amp;(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var k=b.createElement("script"),l,o,e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&amp;&amp;g(k.readyState)&amp;&amp;(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var e=b.createElement("link"),j,c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}})(this,document);AdobeEdge.yepnope = window.yepnope;&#13;
            }&#13;
            // end yepnope&#13;
&#13;
&#13;
            var htFallbacks;&#13;
            var testEle=document.createElement("div");function isSupported(a){var d=testEle.style,e;for(i=0;i&lt;a.length;i++)if(e=a[i],d[e]!==void 0)return!0;return!1}function supportsRGBA(){testEle.cssText="background-color:rgba(150,255,150,.5)";if((""+testEle.style.backgroundColor).indexOf("rgba")==0)return!0;return!1}&#13;
            var hasTransform=isSupported(["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"]),hasSVG=!!document.createElementNS&amp;&amp;!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,hasRGBA=supportsRGBA(),hasJSON=window.JSON&amp;&amp;window.JSON.parse&amp;&amp;window.JSON.stringify,readyToPlay=!1;function safeColor(a){a=""+a;if(!hasRGBA&amp;&amp;a.indexOf("rgba")==0){var d=a.lastIndexOf(",");d&gt;0&amp;&amp;(a="rgb("+a.substring(5,d)+")")}return a}&#13;
            AdobeEdge._preloaders=AdobeEdge._preloaders||[];AdobeEdge._preloaders.push(function(){filesToLoad&amp;&amp;(loadResources(filesToLoad),filesToLoad=void 0)});function doLoadResources(){for(var a=0;a&lt;AdobeEdge._preloaders.length;a++)AdobeEdge._preloaders[a]()}AdobeEdge._readyplayers=AdobeEdge._readyplayers||[];AdobeEdge._readyplayers.push(function(){readyToPlay&amp;&amp;AdobeEdge.okToLaunchComposition(compId)});&#13;
            function playWhenReady(){AdobeEdge._playWhenReady=!0;for(var a=0;a&lt;AdobeEdge._readyplayers.length;a++)AdobeEdge._readyplayers[a]()}function edgeCallback(a){htFallbacks[a]&amp;&amp;(a=htFallbacks[a]);AdobeEdge.preload.got[a]=!0;if(a==AdobeEdge.preload.last)!AdobeEdge.bootstrapLoading||AdobeEdge._playWhenReady?AdobeEdge.okToLaunchComposition(compId):readyToPlay=!0,AdobeEdge.preload.busy=!1,AdobeEdge.preload.q.length&gt;0&amp;&amp;(a=AdobeEdge.preload.q.pop(),AdobeEdge.requestResources(a.files,a.callback))}&#13;
            AdobeEdge.requestResources=AdobeEdge.requestResources||function(a,d){AdobeEdge.yepnope.errorTimeout=4E3;AdobeEdge.preload.busy=!0;AdobeEdge.preload.got={};var e,b=a.length,h=[],c;for(e=0;e&lt;b;e++){c=a[e];if(typeof c==="string")url=c,c={load:url};else if(url=c.yep||c.load,c.callback){var k=c.callback;c.callback=function(a,b,c){k(a,b,c)&amp;&amp;d(a,b,c)}}if(!c.callback)c.callback=d;if(!AdobeEdge.preload.got[url])h.push(c),AdobeEdge.preload.last=url}h.length&amp;&amp;AdobeEdge.yepnope(h)};&#13;
            var filesToLoad,dlContent,preContent,doDelayLoad,signaledLoading,loadingEvt,requiresSVG,htLookup={},aLoader,aEffectors;function loadResources(a,d){AdobeEdge.preload=AdobeEdge.preload||[];AdobeEdge.preload.q=AdobeEdge.preload.q||[];d||!isCapable()?filesToLoad=a:AdobeEdge.preload.busy?AdobeEdge.preload.q.push({files:a,callback:edgeCallback}):AdobeEdge.requestResources(a,edgeCallback);}&#13;
            function splitUnits(a){var d={};d.num=parseFloat(a);if(typeof a=="string")d.units=a.match(/[a-zA-Z%]+$/);if(d.units&amp;&amp;typeof d.units=="object")d.units=d.units[0];return d}function defaultUnits(a){var d=a;if(a!=="auto"&amp;&amp;(a=splitUnits(a),!a||!a.units))d+="px";return d}function findNWC(a,d){if(String(a.className).indexOf(d)!=-1)return a;for(var e=a.childNodes,b=0;b&lt;e.length;b++){var h=findNWC(e[b],d);if(h!=!1)return h}return!1}&#13;
            function simpleContent(a,d,e){var b=document.getElementsByTagName("body")[0],e=e||findNWC(b,compId),h,c,k,g;if(e){if(e.style.position!="absolute"&amp;&amp;e.style.position!="relative")e.style.position="relative"}else e=b;for(var m=0;m&lt;a.length;m++){b=a[m];b.type=="image"?(h=document.createElement("img"),h.src=b.fill[1]):h=document.createElement("div");h.id=b.id;g=h.style;if(b.type=="text"){if(c=b.font){if(c[0]&amp;&amp;c[0]!=="")g.fontFamily=c[0];typeof c[1]!="object"&amp;&amp;(c[1]=[c[1]]);c[1][1]||(c[1][1]="px");if(c[1][0]&amp;&amp;&#13;
                c[1][0]!=="")g.fontSize=c[1][0]+c[1][1];if(c[2]&amp;&amp;c[2]!=="")g.color=safeColor(c[2]);if(c[3]&amp;&amp;c[3]!=="")g.fontWeight=c[3];if(c[4]&amp;&amp;c[4]!=="")g.textDecoration=b.font[4];if(c[5]&amp;&amp;c[5]!=="")g.fontStyle=b.font[5]}if(b.align&amp;&amp;b.align!="auto")g.textAlign=b.align;if(b.position)g.position=b.position;if((!b.rect[2]||b.rect[2]&lt;=0)&amp;&amp;(!b.rect[3]||b.rect[3]&lt;=0))g.whiteSpace="nowrap";h.innerHTML=window.xssUtils.sanitize(b.text)}if(d)h.className=d;g.position="absolute";c=b.rect[0];k=b.rect[1];if(b.transform&amp;&amp;b.transform[0]){var j=b.transform[0][0],&#13;
                f=splitUnits(j);if(f&amp;&amp;f.units&amp;&amp;(j=f.num,f.units=="%"&amp;&amp;b.rect[2])){var f=b.rect[2],l=splitUnits(b.rect[2]);if(l&amp;&amp;l.units)f=l.num,l.units=="%"&amp;&amp;(f=f/100*e.offsetWidth);j=j/100*f;e.offsetWidth&gt;0&amp;&amp;(j=j/e.offsetWidth*100)}if(f=splitUnits(c))c=f.num;c+=j;if(!f.units)f.units="px";c+=f.units;if(b.transform[0].length&gt;1){j=b.transform[0][1];if((f=splitUnits(j))&amp;&amp;f.units)if(j=f.num,f.units=="%"&amp;&amp;b.rect[3]){f=b.rect[3];if((l=splitUnits(b.rect[3]))&amp;&amp;l.units)f=l.num,l.units=="%"&amp;&amp;(f=f/100*e.offsetHeight);j=j/100*&#13;
                f;e.offsetHeight&gt;0&amp;&amp;(j=j/e.offsetHeight*100)}if(f=splitUnits(k))k=f.num;k+=j;if(!f.units)f.units="px";k+=f.units}}g.left=defaultUnits(c);g.top=defaultUnits(k);g.width=defaultUnits(b.rect[2]);g.height=defaultUnits(b.rect[3]);if(b.linkURL)htLookup[h.id]=b,h.onclick=function(){var a=htLookup[this.id];a.linkTarget?window.open(a.linkURL,a.linkTarget):window.location.href=a.linkURL},g.cursor="pointer";e.appendChild(h);if(b.c)for(g=0;g&lt;b.c.length;g++)simpleContent(b.c[g],d,h)}}&#13;
            var fnCycle=function(a){a?fnCycle&amp;&amp;setTimeout(fnCycle,20):a={event:"loading",progress:0};loadingEvt&amp;&amp;loadingEvt(a)},aBootcompsLoaded=[];if(!window.AdobeEdge.bootstrapListeners)window.AdobeEdge.bootstrapListeners=[];window.AdobeEdge.bootstrapCallback=function(a){window.AdobeEdge.bootstrapListeners.push(a);if(aBootcompsLoaded.length&gt;0)for(var d=0;d&lt;aBootcompsLoaded.length;d++)a(aBootcompsLoaded[d])};if(!window.AdobeEdge.preloadComplete)window.AdobeEdge.preloadComplete={};&#13;
		//window.AdobeEdge.preloadComplete&#13;
            window.AdobeEdge.preloadComplete[compId]=function(a){&#13;
				presenter.loadMediaToAnimation(presenter.model);&#13;
                AdobeEdge.$_(".edgePreload"+a).css("display","none");&#13;
				fnCycle=null;loadingEvt&amp;&amp;loadingEvt({event:"done",progress:1,reason:"complete"});aBootcompsLoaded.push(a);for(var d=window.AdobeEdge.bootstrapListeners.length,e=0;e&lt;d;e++)try{window.AdobeEdge.bootstrapListeners[e](a)}catch(b){console.log("bootstrap error "+b)}&#13;
				//hide loading icon&#13;
				var loadingIconImg = presenter.$view.find('.edge-loading-image')[0];&#13;
				$(loadingIconImg).css('display','none');&#13;
			};&#13;
			function isCapable(){if(hasTransform){if(requiresSVG&amp;&amp;!hasSVG)return!1;return!0}return!1}&#13;
            onDocLoaded = function(){window.AdobeEdge.loaded=!0;fnCycle({event:"begin"});isCapable()?(preContent&amp;&amp;preContent.dom&amp;&amp;simpleContent(preContent.dom,"edgePreload"+compId),filesToLoad&amp;&amp;!signaledLoading&amp;&amp;(loadResources(filesToLoad),filesToLoad=void 0)):dlContent&amp;&amp;dlContent.dom&amp;&amp;(loadingEvt&amp;&amp;loadingEvt({event:"done",progress:1,reason:"downlevel"}),simpleContent(dlContent.dom))};&#13;
            window.AdobeEdge = window.AdobeEdge || {};&#13;
            window.AdobeEdge.framework = 'jquery';&#13;
&#13;
            onDocLoaded();&#13;
&#13;
            requiresSVG=false;&#13;
&#13;
            doDelayLoad=false;&#13;
            htFallbacks={&#13;
            };&#13;
&#13;
            var edgeRuntimePath = DOMOperationsUtils.getResourceFullPath(presenter.playerController, "addons/resources/edge2.0.1.268.js");&#13;
&#13;
            aLoader = [&#13;
                { load: edgeRuntimePath},&#13;
                { load: animation.edgeFile},&#13;
                { load: animation.edgeActionsFile}&#13;
            ];&#13;
&#13;
            if (AdobeEdge.bootstrapLoading){&#13;
                signaledLoading = true;&#13;
                AdobeEdge.loadResources=doLoadResources;&#13;
                AdobeEdge.playWhenReady=playWhenReady;&#13;
            }&#13;
&#13;
            loadResources(aLoader, doDelayLoad);&#13;
				&#13;
            preContent={&#13;
                dom: [&#13;
                ]};//simpleContent&#13;
&#13;
            dlContent={dom: [ ]};//simpleContent&#13;
&#13;
            AdobeEdge.loadResources();&#13;
			AdobeEdge.playWhenReady();&#13;
			&#13;
			AdobeEdge.bootstrapCallback(function(compId) {&#13;
				//necessary for situation with identical animations on succeeding pages&#13;
				$.each(AdobeEdge.compositionDefns, function() {&#13;
					this.launched = false;&#13;
				});&#13;
				presenter.setAutoplay(compId);//necessary for handling reset&#13;
			});&#13;
			&#13;
        })(animation.compositionClass);&#13;
    }&#13;
	&#13;
	presenter.setVisibility = function(isVisible) {&#13;
		presenter.isVisible = isVisible;&#13;
		presenter.$view.css("visibility", isVisible ? "visible" : "hidden");&#13;
	};&#13;
	&#13;
	presenter.show = function() {&#13;
		presenter.setVisibility(true);&#13;
	};&#13;
	&#13;
	presenter.hide = function() {&#13;
		presenter.setVisibility(false);&#13;
	};	&#13;
	&#13;
	presenter.setAutoplay = function(compId){&#13;
		var myAnim = AdobeEdge.getComposition(compId),&#13;
		mySymbol = myAnim.getStage();&#13;
		presenter.autoplayState = mySymbol.timelines["Default Timeline"].autoPlay;&#13;
	};&#13;
&#13;
    presenter.executeCommand = function(name, params) {&#13;
        var commands = {&#13;
            'show': presenter.show,&#13;
            'hide': presenter.hide,&#13;
            'switchAnimation': presenter.switchAnimation,&#13;
            'getEdgeComposition' : presenter.getEdgeComposition,&#13;
            'getEdgeStage' : presenter.getEdgeStage,&#13;
            'stop': presenter.stop,&#13;
            'play': presenter.play,&#13;
            'pause' : presenter.pause&#13;
        };&#13;
&#13;
        Commands.dispatch(commands, name, params, presenter);&#13;
    };&#13;
&#13;
    presenter.switchAnimation = function(item){&#13;
        currentAnimationItem = item;&#13;
        $(presenter.Animations).each(function(i,v){&#13;
            if(item == (i+1)){&#13;
                $('#Stage' + presenter.addonID + v.compositionClass).css("display", "block");&#13;
            }else{&#13;
                $('#Stage' + presenter.addonID + v.compositionClass).css("display", "none");&#13;
            }&#13;
        });&#13;
    };&#13;
&#13;
    presenter.pause = function(position){&#13;
        var currCompClass = presenter.Animations[currentAnimationItem - 1].compositionClass,&#13;
            myAnim = AdobeEdge.getComposition(currCompClass),&#13;
            mySymbol = myAnim.getSymbols("stage")[0],&#13;
            currentPosition = position != undefined ? position[0] : mySymbol.getPosition();&#13;
&#13;
		//stop "stage" and all its children in their current positions&#13;
        mySymbol.stop(currentPosition);&#13;
        var childSymbols = mySymbol.getChildSymbols();&#13;
		&#13;
		pauseAllRecursively = function(symbols){&#13;
			$.each(symbols,function(i,child){&#13;
				child.stop(child.getPosition());&#13;
				var grandChildren = child.getChildSymbols();&#13;
				if(grandChildren.length&gt;0){&#13;
					pauseAllRecursively(grandChildren);&#13;
				}&#13;
			});&#13;
		};&#13;
		pauseAllRecursively(childSymbols);&#13;
    };&#13;
&#13;
    presenter.stop = function() {&#13;
        var currCompClass = presenter.Animations[currentAnimationItem - 1].compositionClass,&#13;
            myAnim = AdobeEdge.getComposition(currCompClass),&#13;
            mySymbol = myAnim.getSymbols("stage")[0];&#13;
&#13;
		//stop "stage" and all its children in 0&#13;
        mySymbol.stop(0);&#13;
        var childSymbols = mySymbol.getChildSymbols();&#13;
		&#13;
		stopAllRecursively = function(symbols){&#13;
			$.each(symbols,function(i,child){&#13;
				child.stop(0);&#13;
				var grandChildren = child.getChildSymbols();&#13;
				if(grandChildren.length&gt;0){&#13;
					stopAllRecursively(grandChildren);&#13;
				}&#13;
			});&#13;
		};&#13;
		stopAllRecursively(childSymbols);&#13;
    };&#13;
&#13;
    presenter.play = function(position){&#13;
		var currCompClass = presenter.Animations[currentAnimationItem - 1].compositionClass;&#13;
		var myAnim = AdobeEdge.getComposition(currCompClass);&#13;
			mySymbol = myAnim.getStage(),&#13;
			currentPosition = position != undefined ? position[0] : mySymbol.getPosition();&#13;
		&#13;
		//play "stage" and all its children from their current positions&#13;
		mySymbol.play(currentPosition);&#13;
		var childSymbols = mySymbol.getChildSymbols();&#13;
		&#13;
		playAllRecursively = function(symbols){&#13;
			$.each(symbols,function(i,child){&#13;
				child.play(child.getPosition());&#13;
				var grandChildren = child.getChildSymbols();&#13;
				if(grandChildren.length&gt;0){&#13;
					playAllRecursively(grandChildren);&#13;
				}&#13;
			});&#13;
		};&#13;
		playAllRecursively(childSymbols);&#13;
    };&#13;
	&#13;
	presenter.getEdgeComposition = function(Item){&#13;
		var i = Item != undefined ? Item[0] : currentAnimationItem;&#13;
		var currCompClass = presenter.Animations[i - 1].compositionClass;&#13;
&#13;
		return AdobeEdge.getComposition(currCompClass);&#13;
    };&#13;
	&#13;
	presenter.getEdgeStage = function(Item){&#13;
		var i = Item != undefined ? Item[0] : currentAnimationItem;&#13;
		var currCompClass = presenter.Animations[i - 1].compositionClass;&#13;
		var myAnim = AdobeEdge.getComposition(currCompClass);&#13;
		&#13;
		return myAnim.getStage();&#13;
    };&#13;
&#13;
    presenter.setShowErrorsMode = function(){&#13;
		return;&#13;
    };&#13;
&#13;
    presenter.setWorkMode = function(){&#13;
        return;&#13;
    };&#13;
&#13;
    presenter.reset = function(){&#13;
		var initAnimItem = presenter.model.initialAnimation+1;&#13;
		&#13;
		presenter.switchAnimation(initAnimItem);            &#13;
		&#13;
		presenter.stop(0);&#13;
		if(presenter.autoplayState){&#13;
			presenter.play(0);&#13;
		}&#13;
&#13;
    };&#13;
&#13;
    presenter.getState = function(){&#13;
		//stop "stage" and all its children&#13;
		$(Animations).each(function(i,animation){&#13;
			var currCompClass = animation.compositionClass,&#13;
				myAnim = AdobeEdge.getComposition(currCompClass),&#13;
				mySymbol = myAnim.getSymbols("stage")[0];&#13;
&#13;
			mySymbol.stop(0);&#13;
			var childSymbols = mySymbol.getChildSymbols();&#13;
			&#13;
			stopAllRecursively = function(symbols){&#13;
				$.each(symbols,function(i,child){&#13;
					child.stop(0);&#13;
					var grandChildren = child.getChildSymbols();&#13;
					if(grandChildren.length&gt;0){&#13;
						stopAllRecursively(grandChildren);&#13;
					}&#13;
				});&#13;
			};&#13;
			stopAllRecursively(childSymbols);&#13;
		});&#13;
		&#13;
        return JSON.stringify({&#13;
            'currentAnimationItem' : currentAnimationItem,&#13;
            'isVisible' : presenter.isVisible&#13;
        });&#13;
    };&#13;
&#13;
    presenter.setState = function(state){&#13;
        var parsedState = JSON.parse(state);&#13;
	&#13;
		currentAnimationItem = parsedState.currentAnimationItem;&#13;
		presenter.isVisible = parsedState.isVisible;&#13;
		presenter.setVisibility(presenter.isVisible);&#13;
		&#13;
        //setting definitions launched to false, so the AdobeEdge.launchComposition has to create composition again&#13;
        $.each(AdobeEdge.compositionDefns, function() {&#13;
            this.launched = false;&#13;
        });&#13;
    };&#13;
	&#13;
    return presenter;&#13;
}&#13;
</presenter></addon>